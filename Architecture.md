# Architecture

## How Sqlite works

A query goes through a chain of components in order to retrieve data. The **front-end** consists of the:

- tokenizer
- parser
- code generator

The input to the front-end is a SQL query. The output is sqlite virtual machine bytecode (essentially a compiled program that can operate on the database).

The **back-end** consists of the:

- virtual machine
- B-tree
- pager
- os interface

The **virtual machine** takes bytecode generated by the front-end as instructions. It can then perform operations on one or more tables or indexes, each of which is stored in a data structure called a B-tree. The VM is essentially a big switch statement on the type of bytecode instruction.

Each **B-tree** consists of many nodes. Each node is one page in lenght. The B-tree can retrieve a page from disk or save it back to disk by issuing commands to the pager.

The **pager** receives commands to read or write pages of data. It is responsible for reading/writing at appropriate offsets in the database file. It also keeps a cache of recently-accessed pages in memory, and determines when those pages need to be written back to disk.

The **os interface** is the layer that differs depending on which operating system sqlite was compiled for.

## sqldb project structure

```
- src
  |- lib.rs
  |- main.rs
  |- utils.rs
  |- sql
     |- tokenizer.rs
     |- parser.rs
     |- code_generator.rs
  |- storage
     |- mod.rs
     |- b_tree.rs
     |- pager.rs
  |- os_interface.rs
```

### Explanation of Project Structure:

- `src/lib.rs`: This file serves as the entry point for library crate. It defines the public API of `sqldb` database system and re-exports the modules or items that you want to expose.
- `src/main.rs`: This file serves as the entry point for executable crate. It contains the main function and any necessary code for initializing database and starting the execution.
- `src/sql/`: This directory contains modules related to SQL query processing.
    - `src/sql/tokenizer.rs`: Implements the tokenizer module responsible for converting SQL queries into tokens.
    - `src/sql/parser.rs`: Handles parsing the tokens generated by the tokenizer and constructs an abstract syntax tree (AST) representing the SQL query.
    - `src/sql/code_generator.rs`: Converts the AST into bytecode instructions for the virtual machine.
- `src/storage/`: This directory contains modules related to data storage.
    - `src/storage/b_tree.rs`: Implements the B-tree data structure for efficient indexing and searching of data.
    - `src/storage/pager.rs`: Manages the disk pages and handles reading and writing data to the disk. It interacts with the OS interface for file system operations.
- `src/os_interface.rs`: Provides an interface to interact with the operating system, such as file system operations or system calls required by the database. This file can be used to implement the necessary functions based on the target operating system.
